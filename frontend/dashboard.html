<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DhanRekha ‚Äì Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#22c55e">

  <link rel="shortcut icon" href="assets/icons/dashboard.png" type="image/png">
  <link rel="stylesheet" href="css/glass.css" />
  <link rel="stylesheet" href="css/dashboard.css" />
</head>
<body>

  <!-- Auth Guard -->
  <script src="js/authGuard.js"></script>



  <!-- Navbar -->
  <nav class="navbar glass-card">
    <div class="logo">
        <img src="assets/logo1.png" alt="DhanRekha Logo" />
        <span>DhanRekha</span>
    </div>

    <div class="nav-actions">
      <div class="nav-actions">
        <button id="biometricToggle" onclick="toggleBiometric()">
          üîê Enable App Lock
        </button>

        <button onclick="logout()">Logout</button>
      </div>


  </nav>

  <!-- Main Dashboard -->
  <main class="container">

    <!-- Balance Card -->
    <section class="balance-card glass-card">
      <h3>Remaining Balance</h3>
      <p id="balance">‚Çπ0</p>
    </section>

    <!-- Quick Actions -->
    <section class="actions">
      <button onclick="openExpense()">‚ûï New Expense</button>
      <button onclick="openIncome()">‚ûï Monthly Budget</button>
    </section>

    <!-- Summary Cards -->
    <section class="summary">
      <div class="summary-card glass-card">
        <h4>Total Income</h4>
        <p id="totalIncome">‚Çπ0</p>
      </div>
      <div class="summary-card glass-card">
        <h4>Total Expense</h4>
        <p id="totalExpense">‚Çπ0</p>
      </div>
    </section>

    <!-- Add Expense Modal -->
<div id="expenseModal" class="modal hidden">
  <div class="modal-content glass-card">
    <h3>Add Expense</h3>

    <input type="number" id="expenseAmount" placeholder="Amount (‚Çπ)" />
    
    <select id="expenseCategory">
      <option value="">Select Category</option>
      <option value="Food">Food</option>
      <option value="Travel">Travel</option>
      <option value="Rent">Rent</option>
      <option value="Shopping">Shopping</option>
      <option value="Other">Other</option>
    </select>

    <input type="date" id="expenseDate" />

    <input type="text" id="expenseDesc" placeholder="Description (optional)" />

    <div class="modal-actions">
      <button onclick="addExpense()">Save</button>
      <button class="cancel" onclick="closeExpense()">Cancel</button>
    </div>
  </div>
</div>

<!-- Add Income Modal -->
<div id="incomeModal" class="modal hidden">
  <div class="modal-content glass-card">
    <h3>Add Income</h3>

    <input type="number" id="incomeAmount" placeholder="Amount (‚Çπ)" />
    <input type="text" id="incomeSource" placeholder="Source (Salary, Freelance)" />
    <input type="date" id="incomeDate" />

    <div class="modal-actions">
      <button onclick="addIncome()">Save</button>
      <button class="cancel" onclick="closeIncome()">Cancel</button>
    </div>
  </div>
</div>


<section class="filters glass-card" style="margin-top: 20px; padding: 15px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
  <label style="color: white; font-weight: 500;">Date Range:</label>
  <input type="date" id="startDate" style="padding: 8px; border-radius: 6px; border: none;">
  <input type="date" id="endDate" style="padding: 8px; border-radius: 6px; border: none;">
  <button onclick="filterCharts()" style="padding: 8px 16px; border-radius: 6px; border: none; background: #22c55e; color: white; cursor: pointer;">Filter</button>
  <button onclick="resetFilters()" style="padding: 8px 16px; border-radius: 6px; border: none; background: #64748b; color: white; cursor: pointer;">Reset</button>
</section>

<section class="charts">

  <!-- Category Pie -->
  <div class="chart-card glass-card">
    <h3>Spending by Category</h3>
    <canvas id="categoryChart"></canvas>
  </div>

  <!-- Weekly Trend -->
  <div class="chart-card glass-card">
    <h3>Last 7 Days Trend</h3>
    <canvas id="weeklyChart"></canvas>
  </div>

  <!-- Monthly Histogram -->
  <div class="chart-card glass-card">
    <h3>Monthly Expenses</h3>
    <canvas id="monthlyChart"></canvas>
  </div>

</section>




<!-- Expense List -->
<section class="expense-list glass-card">
  <div class="expense-header">
    <h3>Recent Expenses</h3>
    <button onclick="loadAllExpenses()">View All</button>
  </div>



  <ul id="expenseList">
    <li>Loading expenses...</li>
  </ul>
</section>



  </main>


  <script>
  const biometricBtn = document.getElementById("biometricToggle");

  // Set initial state
  if (localStorage.getItem("biometricEnabled") === "true") {
    biometricBtn.innerText = "üîì Disable App Lock";
  }

  async function toggleBiometric() {
    if (!window.PublicKeyCredential) {
      alert("Biometric authentication not supported on this device");
      return;
    }

    const enabled = localStorage.getItem("biometricEnabled") === "true";

    if (enabled) {
      // Disable
      localStorage.removeItem("biometricEnabled");
      sessionStorage.removeItem("biometricUnlocked");
      biometricBtn.innerText = "üîê Enable App Lock";
      alert("App lock disabled");
      return;
    }

    // Enable biometric (verify once)
    try {
      await navigator.credentials.get({
        publicKey: {
          challenge: crypto.getRandomValues(new Uint8Array(32)),
          timeout: 60000,
          userVerification: "required"
        }
      });

      localStorage.setItem("biometricEnabled", "true");
      biometricBtn.innerText = "üîì Disable App Lock";
      alert("App lock enabled successfully");

    } catch (err) {
      alert("Biometric authentication failed");
    }
  }

  function logout() {
    localStorage.removeItem("token");
    localStorage.removeItem("biometricEnabled");
    sessionStorage.clear();
    window.location.href = "index.html";
  }
</script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


  <script type="module" src="js/dashboard.js"></script>
  <script src="js/authGuard.js"></script>


</body>
</html>
